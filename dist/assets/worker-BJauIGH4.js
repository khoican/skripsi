(function(){"use strict";const i=n=>n.toLowerCase().replace(/[^\w\s]/g,"").split(" "),M=(n,o)=>{const e=i(o);return e.filter(s=>s===n).length/e.length},p=(n,o)=>{const e=o.filter(t=>i(t).includes(n)).length;return Math.log(o.length/(1+e))},C=(n,o,e)=>M(n,o)*p(n,e);function f(n,o){const e=[];for(let t=0;t<=o.length;t++)e[t]=[t];for(let t=0;t<=n.length;t++)e[0][t]=t;for(let t=1;t<=o.length;t++)for(let s=1;s<=n.length;s++)o.charAt(t-1)===n.charAt(s-1)?e[t][s]=e[t-1][s-1]:e[t][s]=Math.min(e[t-1][s-1]+1,e[t][s-1]+1,e[t-1][s]+1);return e[o.length][n.length]}const x=(n,o)=>{if(!o||o.length===0||!n)return null;const e=o.map(t=>({token:t,distance:f(n,t)})).sort((t,s)=>t.distance-s.distance)[0];return e&&e&&e.distance<=Math.ceil(n.length/2)?e.token:null},w=(n,o)=>{const e=performance.now(),t=i(n),s=Array.from(new Set(o.flatMap(c=>i(c.name)))),h=o.map(c=>{const a=i(c.name);if(!a||a.length===0)return{product:c,score:0,totalDistance:0,exactMatchCount:0};const m={};s.forEach(r=>{m[r]=C(r,c.name,o.map(l=>l.name))});let u=0;const g=t.map(r=>{const l=x(r,a);if(l){const T=f(r,l);return u+=T,console.log(`Distance from "${r}" to "${l}":`,T),l}return r}),d=g.filter(r=>a&&a.includes(r)).length,j=g.reduce((r,l)=>r+(m[l]||0),0),q=d*2,A=j+q-u*.1;return{product:c,score:A,totalDistance:u,exactMatchCount:d}});console.log(h);const y=h.sort((c,a)=>a.score-c.score).filter(c=>c.score>0).map(c=>c.product),D=performance.now()-e;return{data:y,executionTime:D}};self.onmessage=function(n){const{searchQuery:o,products:e}=n.data,t=w(o,e);self.postMessage(t)}})();
