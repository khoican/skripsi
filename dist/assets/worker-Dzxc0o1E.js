(function(){"use strict";const l=n=>n.toLowerCase().replace(/[^\w\s]/g,"").split(" "),M=(n,c)=>{const e=l(c);return e.filter(o=>o===n).length/e.length},C=(n,c)=>{const e=c.filter(t=>l(t).includes(n)).length;return Math.log(c.length/(1+e))},D=(n,c,e)=>M(n,c)*C(n,e);let u=null;const m=n=>{const c=Array.from(new Set(n.flatMap(e=>l(e.name))));u={},n.forEach(e=>{const t={};c.forEach(o=>{t[o]=D(o,e.name,n.map(f=>f.name))}),u[e.name]=t})},F=()=>u;function d(n,c){const e=[];for(let t=0;t<=c.length;t++)e[t]=[t];for(let t=0;t<=n.length;t++)e[0][t]=t;for(let t=1;t<=c.length;t++)for(let o=1;o<=n.length;o++)c.charAt(t-1)===n.charAt(o-1)?e[t][o]=e[t-1][o-1]:e[t][o]=Math.min(e[t-1][o-1]+1,e[t][o-1]+1,e[t-1][o]+1);return e[c.length][n.length]}const p=(n,c)=>{if(!c||c.length===0||!n)return null;const e=c.map(t=>({token:t,distance:d(n,t)})).sort((t,o)=>t.distance-o.distance)[0];return e&&e&&e.distance<=Math.ceil(n.length/2)?e.token:null},x=(n,c)=>{const e=performance.now();m(c);let t=F();if(!t)return console.error("TF-IDF Cache tidak ditemukan!"),{data:[],executionTime:0};const o=l(n),f=.3,I=Math.ceil(n.length/2),A=1,k=c.map(s=>{const a=l(s.name);if(!a||a.length===0)return{product:s,score:0,totalDistance:999,exactMatchCount:0};let h=0;const T=o.map(r=>{const i=p(r,a);if(i){const N=d(r,i);return h+=N,i}return r}),g=T.filter(r=>a.includes(r)).length,S=t[s.name]||{},_=T.reduce((r,i)=>r+(S[i]||0),0),y=g*2,E=_+y-h*.1;return{product:s,score:E,totalDistance:h,exactMatchCount:g}}).filter(s=>s.score>=f&&s.totalDistance<=I&&s.exactMatchCount>=A).sort((s,a)=>a.score-s.score).map(s=>s.product),w=performance.now()-e;return{data:k,executionTime:w}};self.onmessage=function(n){const{searchQuery:c,products:e}=n.data;m(e);const t=x(c,e);self.postMessage(t)}})();
